generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Course {
  id          String   @id @default(cuid())
  slug        String   @unique
  title       String
  description String
  productId   Int?
  sku         String?
  heroUrl     String?
  isPublished Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  modules      Module[]
  entitlements Entitlement[]
  productMaps  ProductMap[]

  @@map("courses")
}

model Module {
  id          String   @id @default(cuid())
  courseId    String
  title       String
  description String?
  order       Int
  isPublished Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  course  Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  lessons Lesson[]

  @@map("modules")
}

model Lesson {
  id            String   @id @default(cuid())
  moduleId      String
  slug          String
  title         String
  bunnyPath     String
  durationSec   Int?
  order         Int
  isFreePreview Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  module   Module     @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  progress Progress[]

  @@map("lessons")
}

model Entitlement {
  id       String @id @default(cuid())
  courseId String
  userId   String

  course Course @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@unique([courseId, userId])
  @@map("entitlements")
}

model ProductMap {
  id        String @id @default(cuid())
  courseId  String
  productId Int

  course Course @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@unique([courseId, productId])
  @@map("product_maps")
}

model Progress {
  id       String @id @default(cuid())
  lessonId String
  userId   String

  lesson Lesson @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  @@unique([lessonId, userId])
  @@map("progress")
}
